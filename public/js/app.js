(function(){angular.module("Egerep",["ngSanitize","ngResource","ngMaterial","ngMap","ngAnimate","ui.sortable","ui.bootstrap"]).config(["$compileProvider",function(e){return e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|sip):/)}]).run(function(e,t){return e.laroute=laroute,e.dataLoaded=t.defer(),e.frontendStop=function(t){return null==t&&(t=!0),e.frontend_loading=!1,e.dataLoaded.resolve(!0),t?rebindMasks():void 0},e.range=function(e,t,n){var r,o;for(n=n||1,o=[],r=e;t>=r;)o.push(r),r+=n;return o},e.toggleEnum=function(e,t,n){var r,o;return o=Object.keys(n),r=o.indexOf(e[t].toString()),r++,r>o.length-1&&(r=0),e[t]=o[r]},e.formatDateTime=function(e){return moment(e).format("DD.MM.YY в HH:mm")},e.formatDate=function(e,t){return null==t&&(t=!1),moment(e).format("DD.MM.YY"+(t?"YY":""))},e.dialog=function(e){$("#"+e).modal("show")},e.closeDialog=function(e){$("#"+e).modal("hide")},e.ajaxStart=function(){return ajaxStart(),e.saving=!0},e.ajaxEnd=function(){return ajaxEnd(),e.saving=!1}})}).call(this),function(){angular.module("Egerep").factory("Model",function(e){return e("api/models/:id",{},{update:{method:"PUT"}})}).controller("ModelsIndex",function(e,t,n){return e.models=n.query()}).controller("ModelsForm",function(e,t,n,r){return t(function(){return e.id>0?e.model=r.get({id:e.id}):void 0})})}.call(this),function(){angular.module("Egerep").controller("AccountsCtrl",function(e,t,n,r){var o,a,i;return e.PaymentMethods=n,e.DebtTypes=r,e.current_scope=e,a=function(t){return t>0?moment(e.tutor.accounts[t-1].date_end).add(1,"days").toDate():new Date(e.first_attachment_date)},o=function(t){return t+1===e.tutor.accounts.length?"":moment(e.tutor.accounts[t+1].date_end).subtract(1,"days").toDate()},e.changeDateDialog=function(t){return $("#date-end-change").datepicker("destroy"),$("#date-end-change").datepicker({language:"ru",autoclose:!0,orientation:"bottom auto",startDate:a(t),endDate:o(t)}),e.selected_account=e.tutor.accounts[t],e.change_date_end=e.formatDate(e.selected_account.date_end,!0),e.dialog("change-account-date")},e.changeDate=function(){return e.selected_account.date_end=convertDate(e.change_date_end),t.update({id:e.selected_account.id,date_end:e.selected_account.date_end}),e.closeDialog("change-account-date")},e.remove=function(n){return bootbox.confirm("Удалить встречу?",function(r){return r===!0?t["delete"]({id:n.id},function(){return e.tutor.accounts=removeById(e.tutor.accounts,n.id)}):void 0})},e.save=function(){return $.each(e.tutor.accounts,function(e,n){return t.update(n)})},e.getFakeDates=function(){var e,t;for(t=[],e=moment().subtract(10,"days").format("YYYY-MM-DD");e<=moment().format("YYYY-MM-DD");)t.push(e),e=moment(e).add(1,"days").format("YYYY-MM-DD");return t},e.getDates=function(t){var n,r;for(r=[],n=t?moment(e.tutor.accounts[t-1].date_end).add(1,"days").format("YYYY-MM-DD"):moment(e.first_attachment_date).format("YYYY-MM-DD");n<=e.tutor.accounts[t].date_end;)r.push(n),n=moment(n).add(1,"days").format("YYYY-MM-DD");return r},i=function(){var t;return e.tutor.accounts.length>0?(t=e.tutor.accounts[e.tutor.accounts.length-1].date_end,moment(t).add(1,"days").toDate()):new Date(e.first_attachment_date)},e.addAccountDialog=function(){return e.new_account_date_end="",$("#date-end").datepicker("destroy"),$("#date-end").datepicker({language:"ru",startDate:i(),autoclose:!0,orientation:"bottom auto"}),e.dialog("add-account")},e.addAccount=function(){return t.save({date_end:convertDate(e.new_account_date_end),tutor_id:e.tutor.id},function(t){return e.tutor.accounts.push(t),e.closeDialog("add-account")})}})}.call(this),function(){angular.module("Egerep").controller("ClientsIndex",function(e,t,n){return e.clients=n.query()}).controller("ClientsForm",function(e,t,n,r,o,a,i,s,u,c,d,l,m,p,f,g,h,v,k){var y,b,M;return e.RequestStates=c,e.Subjects=d,e.Grades=l,e.ReviewStates=p,e.ReviewScores=g,e.ArchiveStates=f,t.frontend_loading=!0,e.is_dragging_teacher=!1,e.sortableOptions={tolerance:"pointer",activeClass:"drag-active",helper:"clone",appendTo:"body",start:function(t,n){return e.is_dragging_teacher=!0,e.$apply()},stop:function(t,n){return e.is_dragging_teacher=!1,e.$apply(),b()}},e.fake_user={id:0,login:"system"},e.edit=function(){return e.ajaxStart(),y(),e.client.$update().then(function(t){return e.ajaxEnd()})},n(function(){return $(".teacher-remove-droppable").droppable({tolerance:"pointer",hoverClass:"drop-hover",drop:function(t,r){var o;return o=$(r.draggable).data("id"),n(function(){return e.selected_list.tutor_ids=_.without(e.selected_list.tutor_ids,o.toString()),b()})}}),e.users=u.query(),o.get("api/tutors/list").success(function(t){return e.tutors=t}),e.id>0?e.client=a.get({id:e.id},function(n){return e.selected_request=e.request_id?_.findWhere(n.requests,{id:e.request_id}):n.requests[0],sp("list-subjects","выберите предмет"),e.parseHash(),t.frontendStop()}):void 0}),b=function(){return s.update(e.selected_list)},e.parseHash=function(){var t;return t=window.location.hash.split("#"),t.shift(),t[0]&&(e.selected_list=findById(e.selected_request.lists,t[0])),t[1]&&e.selected_list?e.selected_attachment=findById(e.selected_list.attachments,t[1]):void 0},e.toggleArchive=function(){return e.selected_attachment.archive?h["delete"](e.selected_attachment.archive,function(){return delete e.selected_attachment.archive}):h.save({attachment_id:e.selected_attachment.id},function(t){return e.selected_attachment.archive=t})},e.toggleReview=function(){return e.selected_attachment.review?v["delete"](e.selected_attachment.review,function(){return delete e.selected_attachment.review}):v.save({attachment_id:e.selected_attachment.id},function(t){return e.selected_attachment.review=t})},e.attachmentExists=function(t){var n;return n=!1,$.each(e.client.requests,function(e,r){return n?void 0:$.each(r.lists,function(e,r){return $.each(r.attachments,function(e,r){return parseInt(r.tutor_id)===parseInt(t)?n=!0:void 0})})}),n},e.selectAttachment=function(t){return e.selected_attachment=t},e.addList=function(){return e.dialog("add-subject")},e.setList=function(t){return e.selected_list=t,delete e.selected_attachment},e.listExists=function(t){return void 0!==_.findWhere(e.selected_request.lists,{subject_id:parseInt(t)})},e.selectRequest=function(t){return e.selected_request=t,delete e.selected_list},e.toggleUser=function(){var t;return e.selected_request.user||(e.selected_request.user=e.fake_user),t=_.find(e.users,function(t){return t.id>e.selected_request.user.id}),e.selected_request.user=t,e.selected_request.user_id=t.id},e.getUser=function(t){return _.findWhere(e.users,{id:parseInt(t)})},e.addListSubject=function(){s.save({request_id:e.selected_request.id,subjects:e.list_subjects},function(t){return e.selected_request.lists.push(t),e.selected_list=t}),delete e.list_subjects,spRefresh("list-subjects"),$("#add-subject").modal("hide")},e.addListTutor=function(){return e.selected_list.tutor_ids.push(e.list_tutor_id),s.update({id:e.selected_list.id,tutor_ids:e.selected_list.tutor_ids},function(){return delete e.list_tutor_id,$("#add-tutor").modal("hide")})},e.newAttachment=function(t){return m.save({grade:e.client.grade,tutor_id:t,subjects:e.selected_list.subjects,request_list_id:e.selected_list.id},function(t){return e.selected_attachment=t,e.selected_list.attachments.push(t)})},e.addRequest=function(){var t;return t=new i({client_id:e.id}),t.$save().then(function(t){return e.client.requests.push(t),e.selected_request=t,M(!1,!0,!0)})},e.removeRequest=function(){return bootbox.confirm("Вы уверены, что хотите удалить заявку?",function(t){return t===!0?i["delete"]({id:e.selected_request.id},function(){return e.client.requests=removeById(e.client.requests,e.selected_request.id),M(!0,!0,!0)}):void 0})},M=function(t,n,r){return null==t&&(t=!1),null==n&&(n=!1),null==r&&(r=!1),t&&(e.selected_request=null),n&&(e.selected_list=null),r?e.selected_attachment=null:void 0},e.removeList=function(){return bootbox.confirm("Вы уверены, что хотите удалить список?",function(t){return t===!0?s["delete"]({id:e.selected_list.id},function(){return e.selected_request.lists=removeById(e.selected_request.lists,e.selected_list.id),delete e.selected_list,M(!1,!0,!0)}):void 0})},e.removeAttachment=function(){return bootbox.confirm("Вы уверены, что хотите удалить стыковку?",function(t){return t===!0?m["delete"]({id:e.selected_attachment.id},function(){return e.selected_list.attachments=removeById(e.selected_list.attachments,e.selected_attachment.id),delete e.selected_attachment,M(!1,!1,!0)}):void 0})},e.$watch("selected_request.comment",function(t,n){var r;if(void 0!==t||void 0!==n)return void 0===t&&(t=n),e.tutor_ids=[],r=t.match(/Репетитор [\d]+/gi),$.each(r,function(t,n){var r;return r=n.match(/[\d]+/gi),e.tutor_ids.push(parseInt(r))})}),e.$watch("selected_attachment",function(e,t){return void 0!==e?(void 0===t&&sp("attachment-subjects","выберите предмет"),void 0!==t&&spRefresh("attachment-subjects"),rebindMasks()):void 0}),e.marker_id=1,y=function(){var t;return t=[],$.each(e.client.markers,function(e,n){return t.push(_.pick(n,"lat","lng","type","metros"))}),e.client.markers=t},e.$on("mapInitialized",function(t,n){var r;return e.gmap=n,e.loadMarkers(),r={lat:55.7387,lng:37.6032},e.RECOM_BOUNDS=new google.maps.LatLngBounds(new google.maps.LatLng(r.lat-.5,r.lng-.5),new google.maps.LatLng(r.lat+.5,r.lng+.5)),e.geocoder=new google.maps.Geocoder,google.maps.event.addListener(n,"click",function(t){return e.gmapAddMarker(t)})}),e.showMap=function(){var t,n;return $("#gmap-modal").modal("show"),google.maps.event.trigger(e.gmap,"resize"),e.gmap.setCenter(new google.maps.LatLng(55.7387,37.6032)),e.gmap.setZoom(11),$("#map-search").val(""),e.search_markers&&e.search_markers.length&&($.each(e.search_markers,function(e,t){return t.setMap(null)}),e.search_markers=[]),e.client.markers.length&&(t=new google.maps.LatLngBounds,n=0,$.each(e.client.markers,function(e,r){return n++,t.extend(r.position)}),n>0)?(e.gmap.fitBounds(t),e.gmap.panToBounds(t),e.gmap.setZoom(11)):void 0},e.gmapAddMarker=function(t){var n;return n=newMarker(e.marker_id++,t.latLng,e.map),e.client.markers.push(n),n.setMap(e.gmap),k.exec("metro",{lat:n.lat,lng:n.lng}).then(function(e){return n.metros=e.data}),e.bindMarkerDelete(n),e.bindMarkerChangeType(n)},e.bindMarkerDelete=function(t){return google.maps.event.addListener(t,"dblclick",function(t){var n;return n=this,n.setMap(null),$.each(e.client.markers,function(t,r){return console.log("id",n.id,r.id),void 0!==r&&n.id===r.id?e.client.markers.splice(t,1):void 0})})},e.bindMarkerChangeType=function(e){return google.maps.event.addListener(e,"click",function(e){return"green"===this.type?(this.type="red",this.setIcon(ICON_RED)):"red"===this.type?(this.type="blue",this.setIcon(ICON_BLUE)):(this.type="green",this.setIcon(ICON_GREEN))})},e.searchMap=function(t){return e.geocoder.geocode({address:t+", московская область",bounds:e.RECOM_BOUNDS},function(t,n){var r,o;if(n===google.maps.GeocoderStatus.OK){if(r=3,o=new google.maps.LatLngBounds,$.each(t,function(t,n){var a;if(!(t>=r))return o.extend(n.geometry.location),a=new google.maps.Marker({map:e.map,position:n.geometry.location,icon:ICON_SEARCH}),google.maps.event.addListener(a,"click",function(t){return this.setMap(null),e.gmapAddMarker(t)}),e.search_markers=initIfNotSet(e.search_markers),e.search_markers.push(a)}),!(t.length>0))return $("#map-search").addClass("has-error").focus();if(e.gmap.fitBounds(o),e.gmap.panToBounds(o),1===t.length)return e.gmap.setZoom(12)}})},e.gmapsSearch=function(t){return 13===t.keyCode||"click"===t.type?(""===$("#map-search").val()?$("#map-search").addClass("has-error").focus():$("#map-search").removeClass("has-error"),e.searchMap($("#map-search").val())):void 0},e.loadMarkers=function(){return t.dataLoaded.promise.then(function(){var t;return t=[],$.each(e.client.markers,function(n,r){var o;return o=newMarker(e.marker_id++,new google.maps.LatLng(r.lat,r.lng),e.map,r.type),o.metros=r.metros,o.setMap(e.map),e.bindMarkerDelete(o),e.bindMarkerChangeType(o),t.push(o)}),e.client.markers=t})},e.saveMarkers=function(){return $("#gmap-modal").modal("hide")}})}.call(this),function(){angular.module("Egerep").controller("LoginCtrl",function(e,t){return e.checkFields=function(){return t.post("login",{login:e.login,password:e.password}).then(function(e){return e.data===!0?location.reload():void 0})}})}.call(this),function(){angular.module("Egerep").factory("Request",function(e){return e("api/requests/:id",{},{update:{method:"PUT"}})}).controller("RequestsIndex",function(e,t){return e.requests=t.query()}).controller("RequestsForm",function(e){return console.log("here")})}.call(this),function(){angular.module("Egerep").run(function(e){return e.genders={male:"Мужской",female:"Женский"}}).controller("TutorsIndex",function(e,t,n,r,o){return t.frontend_loading=!0,r.get("api/tutors").then(function(n){return t.frontendStop(),e.data=n.data,e.tutors=e.data.data}),e.$watch("current_page",function(n,o){return void 0!==n?r.get("api/tutors?page="+n).then(function(n){return t.frontendStop(),e.data=n.data,e.tutors=e.data.data}):void 0})}).controller("TutorsForm",function(e,t,n,r,o,a,i,s,u){var c,d,l;return e.SvgMap=a,e.Subjects=i,e.Grades=s,t.frontend_loading=!0,e.deletePhoto=function(){return bootbox.confirm("Удалить фото преподавателя?",function(t){return t===!0?e.tutor.$deletePhoto(function(){return e.tutor.has_photo_cropped=!1,e.tutor.has_photo_original=!1}):void 0})},e.saveCropped=function(){return $("#photo-edit").cropper("getCroppedCanvas").toBlob(function(t){var n;return n=new FormData,n.append("croppedImage",t),n.append("tutor_id",e.tutor.id),ajaxStart(),$.ajax("upload/cropped",{method:"POST",data:n,processData:!1,contentType:!1,success:function(){return ajaxEnd(),e.tutor.has_photo_cropped=!0,e.picture_version++,e.$apply(),e.closeDialog("change-photo")}})})},c=function(){return $("#photo-edit").cropper("destroy"),$("#photo-edit").cropper({aspectRatio:.8,minContainerHeight:700,minContainerWidth:700,minCropBoxWidth:120,minCropBoxHeight:150,preview:".img-preview",viewMode:1,crop:function(e){var t;return t=$("#photo-edit").cropper("getCropBoxData").width,t>=240?$(".cropper-line, .cropper-point").css("background-color","#158E51"):$(".cropper-line, .cropper-point").css("background-color","#D9534F")}})},e.picture_version=1,d=function(){return $("#fileupload").fileupload({formData:{tutor_id:e.tutor.id},maxFileSize:1e7,send:function(){return NProgress.configure({showSpinner:!0})},progress:function(e,t){return NProgress.set(t.loaded/t.total)},always:function(){return NProgress.configure({showSpinner:!1}),ajaxEnd()},done:function(t,n){return e.tutor.photo_extension=n.result,e.tutor.has_photo_original=!0,e.tutor.has_photo_cropped=!1,e.picture_version++,e.$apply(),c()}})},e.showPhotoEditor=function(){return e.dialog("change-photo"),n(function(){return $("#photo-edit").cropper("resize")},100)},n(function(){return e.id>0?e.tutor=o.get({id:e.id},function(){return n(function(){return c(),d()},1e3),t.frontendStop()}):void 0}),e.$watch("tutor.subjects",function(e,t){return void 0!==e?(void 0===t&&sp("tutor-subjects","предмет"),void 0!==t?spRefresh("tutor-subjects"):void 0):void 0}),e.$watch("tutor.grades",function(e,t){return void 0!==e?(void 0===t&&sp("tutor-grades","классы"),void 0!==t?spRefresh("tutor-grades"):void 0):void 0}),e.svgSave=function(){return e.tutor.svg_map=a.save()},e.yearDifference=function(e){return moment().format("YYYY")-e},e.add=function(){return e.saving=!0,o.save(e.tutor,function(e){return window.location=laroute.route("tutors.edit",{tutors:e.id})})},e.edit=function(){return e.saving=!0,l(),e.tutor.$update().then(function(t){return e.saving=!1})},e.marker_id=1,l=function(){var t;return t=[],$.each(e.tutor.markers,function(e,n){return t.push(_.pick(n,"lat","lng","type","metros"))}),e.tutor.markers=t},e.$on("mapInitialized",function(t,n){var r;return e.gmap=n,e.loadMarkers(),r={lat:55.7387,lng:37.6032},e.RECOM_BOUNDS=new google.maps.LatLngBounds(new google.maps.LatLng(r.lat-.5,r.lng-.5),new google.maps.LatLng(r.lat+.5,r.lng+.5)),e.geocoder=new google.maps.Geocoder,google.maps.event.addListener(n,"click",function(t){return e.gmapAddMarker(t)})}),e.showMap=function(){var t,n;return $("#gmap-modal").modal("show"),google.maps.event.trigger(e.gmap,"resize"),e.gmap.setCenter(new google.maps.LatLng(55.7387,37.6032)),e.gmap.setZoom(11),$("#map-search").val(""),e.search_markers&&e.search_markers.length&&($.each(e.search_markers,function(e,t){return t.setMap(null)}),e.search_markers=[]),e.tutor.markers.length&&(t=new google.maps.LatLngBounds,n=0,$.each(e.tutor.markers,function(e,r){return n++,t.extend(r.position)}),n>0)?(e.gmap.fitBounds(t),e.gmap.panToBounds(t),e.gmap.setZoom(11)):void 0},e.gmapAddMarker=function(t){var n;return n=newMarker(e.marker_id++,t.latLng,e.map),e.tutor.markers.push(n),n.setMap(e.gmap),u.exec("metro",{lat:n.lat,lng:n.lng}).then(function(e){return n.metros=e.data}),e.bindMarkerDelete(n),e.bindMarkerChangeType(n)},e.bindMarkerDelete=function(t){return google.maps.event.addListener(t,"dblclick",function(t){var n;return n=this,n.setMap(null),$.each(e.tutor.markers,function(t,r){return console.log("id",n.id,r.id),void 0!==r&&n.id===r.id?e.tutor.markers.splice(t,1):void 0})})},e.bindMarkerChangeType=function(e){return google.maps.event.addListener(e,"click",function(e){return"green"===this.type?(this.type="red",this.setIcon(ICON_RED)):(this.type="green",this.setIcon(ICON_GREEN))})},e.searchMap=function(t){return e.geocoder.geocode({address:t+", московская область",bounds:e.RECOM_BOUNDS},function(t,n){var r,o;if(n===google.maps.GeocoderStatus.OK){if(r=3,o=new google.maps.LatLngBounds,$.each(t,function(t,n){var a;if(!(t>=r))return o.extend(n.geometry.location),a=new google.maps.Marker({map:e.map,position:n.geometry.location,icon:ICON_SEARCH}),google.maps.event.addListener(a,"click",function(t){return this.setMap(null),e.gmapAddMarker(t)}),e.search_markers=initIfNotSet(e.search_markers),e.search_markers.push(a)}),!(t.length>0))return $("#map-search").addClass("has-error").focus();if(e.gmap.fitBounds(o),e.gmap.panToBounds(o),1===t.length)return e.gmap.setZoom(12)}})},e.gmapsSearch=function(t){return 13===t.keyCode||"click"===t.type?(""===$("#map-search").val()?$("#map-search").addClass("has-error").focus():$("#map-search").removeClass("has-error"),e.searchMap($("#map-search").val())):void 0},e.loadMarkers=function(){return t.dataLoaded.promise.then(function(){var t;return t=[],$.each(e.tutor.markers,function(n,r){var o;return o=newMarker(e.marker_id++,new google.maps.LatLng(r.lat,r.lng),e.map,r.type),o.metros=r.metros,o.setMap(e.map),e.bindMarkerDelete(o),e.bindMarkerChangeType(o),t.push(o)}),e.tutor.markers=t})},e.saveMarkers=function(){return $("#gmap-modal").modal("hide")}})}.call(this),function(){angular.module("Egerep").value("DebtTypes",{0:"не доплатил",1:"переплатил"}).value("PaymentMethods",{0:"не установлено",1:"стандартный расчет",2:"яндекс.деньги",3:"перевод на сотовый",4:"перевод на карту"}).value("RequestStates",{"new":"невыполненные",awaiting:"в ожидании",finished:"выполненные",deny:"отказы"}).value("ArchiveStates",{impossible:"невозможно",possible:"возможно"}).value("ReviewStates",{unpublished:"не опубликован",published:"опубликован"}).value("ReviewScores",{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:"не берет",12:"не помнит",13:"недоступен",14:"позвонить позже"}).value("Grades",{1:"1 класс",2:"2 класс",3:"3 класс",4:"4 класс",5:"5 класс",6:"6 класс",7:"7 класс",8:"8 класс",9:"9 класс",10:"10 класс",11:"11 класс",12:"студенты",13:"остальные"}).value("Subjects",{all:{1:"математика",2:"физика",3:"химия",4:"биология",5:"информатика",6:"русский",7:"литература",8:"обществознание",9:"история",10:"английский"},full:{1:"Математика",2:"Физика",3:"Химия",4:"Биология",5:"Информатика",6:"Русский язык",7:"Литература",8:"Обществознание",9:"История",10:"Английский язык"},dative:{1:"математике",2:"физике",3:"химии",4:"биологии",5:"информатике",6:"русскому языку",7:"литературе",8:"обществознанию",9:"истории",10:"английскому языку"},"short":["М","Ф","Р","Л","А","Ис","О","Х","Б","Ин"],three_letters:["МАТ","ФИЗ","РУС","ЛИТ","АНГ","ИСТ","ОБЩ","ХИМ","БИО","ИНФ"],short_eng:["math","phys","rus","lit","eng","his","soc","chem","bio","inf"]})}.call(this),function(){angular.module("Egerep").directive("comments",function(){return{restrict:"E",templateUrl:"directives/comments",scope:{user:"=",entityId:"=",entityType:"@"},controller:function(e,t,n){return e.$watch("entityId",function(t,r){return e.comments=n.query({entity_type:e.entityType,entity_id:t})}),e.formatDateTime=function(e){return moment(e).format("DD.MM.YY в HH:mm")},e.startCommenting=function(n){return e.start_commenting=!0,t(function(){return $(n.target).parent().find("input").focus()})},e.endCommenting=function(){return e.comment="",e.start_commenting=!1},e.remove=function(t){return e.comments=_.without(e.comments,_.findWhere(e.comments,{id:t.id})),t.$remove()},e.edit=function(e,t){var n,r;r=e.comment,n=$(t.target),n.unbind("keydown").unbind("blur"),n.attr("contenteditable","true").focus().on("keydown",function(t){return console.log(r),13===t.keyCode&&($(this).removeAttr("contenteditable").blur(),e.comment=$(this).text(),e.$update()),27===t.keyCode?$(this).blur():void 0}).on("blur",function(e){return n.attr("contenteditable")?(console.log(r),n.removeAttr("contenteditable").html(r)):void 0})},e.submitComment=function(t){var r;return 13===t.keyCode&&(r=new n({comment:e.comment,user_id:e.user.id,entity_id:e.entityId,entity_type:e.entityType}),r.$save().then(function(t){return console.log(t),r.user=e.user,r.id=t.id,e.comments.push(r)}),e.endCommenting()),27===t.keyCode?$(t.target).blur():void 0}}}})}.call(this),function(){angular.module("Egerep").directive("email",function(){return{restrict:"E",templateUrl:"directives/email",scope:{address:"="},controller:function(e){return e.send=function(){return $("#email-modal").modal("show")}}}})}.call(this),function(){angular.module("Egerep").directive("metroList",function(){return{restrict:"E",templateUrl:"directives/metro-list",scope:{markers:"="},controller:function(e){return e["short"]=function(e){return e.slice(0,3).toUpperCase()},e.minutes=function(e){return Math.round(e)}}}})}.call(this),function(){angular.module("Egerep").directive("phones",function(){return{restrict:"E",templateUrl:"directives/phones",scope:{entity:"="},controller:function(e,t,n){return n.dataLoaded.promise.then(function(t){return e.level=e.entity.phone3?3:e.entity.phone2?2:1}),e.nextLevel=function(){return e.level++},e.phoneMaskControl=function(t){var n,r;return n=$(t.target),r=n.attr("ng-model").split(".")[1],e.entity[r]=$(t.target).val()},e.isFull=function(e){return void 0===e||""===e?!1:!e.match(/_/)},e.isMobile=function(e){return 9===parseInt(e[4])||9===parseInt(e[1])},e.sms=function(t){return $("#sms-modal").modal("show"),e.$parent.sms_number=t},e.call=function(e){return location.href="sip:"+e.replace(/[^0-9]/g,"")}}}})}.call(this),function(){angular.module("Egerep").directive("ngSelect",function(){return{restrict:"E",replace:!0,scope:{object:"=",model:"=",title:"@"},templateUrl:"directives/ngselect",controller:function(e,t,n,r){return e.title=n.title,e.multiple=n.hasOwnProperty("multiple"),e.$watch("model",function(e,n){return console.log(e,n),void 0!==e?(void 0===n&&spe(t,"предмет"),void 0!==n?spRefresh(t):void 0):void 0})}}})}.call(this),function(){angular.module("Egerep").directive("sms",function(){return{restrict:"E",templateUrl:"directives/sms",scope:{number:"="},controller:function(e,t,n){return e.mass=!1,e.smsCount=function(){return SmsCounter.count(e.message||"").messages},e.send=function(){var t;return e.message?(t=new n({message:e.message,to:e.number,mass:e.mass}),t.$save()):void 0},e.$watch("number",function(t,r){return console.log(e.$parent.formatDateTime(e.created_at)),t?e.history=n.query({number:t}):void 0})}}})}.call(this),function(){var e,t;angular.module("Egerep").factory("Account",function(n){return n(e("accounts"),{id:"@id"},t())}).factory("Review",function(n){return n(e("reviews"),{id:"@id"},t())}).factory("Archive",function(n){return n(e("archives"),{id:"@id"},t())}).factory("Attachment",function(n){return n(e("attachments"),{id:"@id"},t())}).factory("RequestList",function(n){return n(e("lists"),{id:"@id"},t())}).factory("Request",function(n){return n(e("requests"),{id:"@id"},t())}).factory("Sms",function(n){return n(e("sms"),{id:"@id"},t())}).factory("Comment",function(n){return n(e("comments"),{id:"@id"},t())}).factory("Client",function(n){return n(e("clients"),{id:"@id"},t())}).factory("User",function(n){return n(e("users"),{id:"@id"},t())}).factory("Tutor",function(t){return t(e("tutors"),{id:"@id"},{update:{method:"PUT"},deletePhoto:{url:e("tutors","photo"),method:"DELETE"},list:{method:"GET"}})}),e=function(e,t){return null==t&&(t=""),"api/"+e+"/"+(t?t+"/":"")+":id"},t=function(){return{update:{method:"PUT"}}}}.call(this),function(){angular.module("Egerep").service("ApiService",function(e){return this.exec=function(t,n){return e.post("api/external/"+t,n)},this})}.call(this),function(){angular.module("Egerep").service("SvgMap",function(){return this.map=new SVGMap({iframeId:"map",clicable:!0,places:[],placesHash:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,180,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211],groups:[{id:"1",title:"внутри кольца",points:[4,8,12,15,18,19,38,47,48,51,54,56,58,60,63,66,68,71,74,82,83,86,90,91,92,102,104,109,111,120,122,126,129,131,132,133,137,138,140,153,156,157,158,187,188,189,190,191,192,193,194,195,196,198,199]},{id:"2",title:"красная север",points:[55,106,124,145,154]},{id:"3",title:"красная юг",points:[33,108,125,148,151,164,209,210]},{id:"4",title:"зеленая север",points:[9,28,29,36,112,123]},{id:"5",title:"зеленая юг",points:[2,39,44,46,50,53,88,152,197,202,204]},{id:"6",title:"синяя запад",points:[32,59,62,75,76,77,93,121,127,186,203]},{id:"7",title:"синяя восток",points:[13,42,94,95,119,161,163]},{id:"8",title:"голубая",points:[11,62,64,99,128,149,150,186]},{id:"9",title:"оранжевая север",points:[5,10,20,26,72,113,117]},{id:"10",title:"оранжевая юг",points:[3,16,43,52,65,84,85,110,135,159,166]},{id:"11",title:"фиолетовая север",points:[14,87,100,103,130,141,142,162]},{id:"12",title:"фиолетовая юг",points:[30,35,57,61,107,115,134,205,206,211]},{id:"13",title:"желтая",points:[1,81,96,101,114,160,180]},{id:"14",title:"серая север",points:[6,17,27,37,89,97,116,136]},{id:"15",title:"серая юг",points:[7,23,45,78,79,80,105,118,139,143,147,155,165]},{id:"16",title:"светло-зеленая",points:[21,31,41,49,53,57,67,70,98,101,107,114,200,201,202]},{id:"17",title:"бутовская",points:[22,23,24,84,144,146,147,207,208]},{id:"18",title:"каховская",points:[25,45,46,118,197]}]}),this.show=function(e){var t;return $("#svg-modal").modal("show"),t=this.map,t.init(),t.selected={},t.deselectAll(),t.select(e),$(".legend a").unbind("click"),$(".legend a").on("click",function(){var e;return e=$(this).attr("data-rel"),t.toggleGroup(e)})},this.save=function(){return $("#svg-modal").modal("hide"),this.map.save()},this})}.call(this);